<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Interactive C++ for HPC | John T. Foster</title>
<link href="../../assets/css/bitter.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/main.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://johntfoster.github.io/posts/interactive-c%2B%2B-for-hpc/">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
 tex2jax: {
     inlineMath: [ ['$','$'], ["\\(","\\)"] ],
     displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
 },
 displayAlign: 'left', // Change this to 'center' to center equations.
 "HTML-CSS": {
     styles: {'.MathJax_Display': {"margin": 0}}
 }
});
</script><!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]--><meta name="author" content="John T. Foster">
<meta property="og:site_name" content="John T. Foster">
<meta property="og:title" content="Interactive C++ for HPC">
<meta property="og:url" content="http://johntfoster.github.io/posts/interactive-c%2B%2B-for-hpc/">
<meta property="og:description" content='I recently discovered cling after I saw this Tweet
I made a C++ kernel for Jupyter for some reason: https://t.co/7ApuZyeR0r— Min RK (@minrk) May 19, 2015

From the cling website, "Cling is an interact'>
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-06-08T11:00:18-05:00">
<meta property="article:tag" content="AztecOO">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="cling">
<meta property="article:tag" content="Epetra">
<meta property="article:tag" content="Trilinos">
</head>
<body>
    <section class="social"><ul>
<li><a href="../../index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="http://johnfoster.pge.utexas.edu" title="About me"><i class="icon-user"></i></a></li>
            <li><a href="https://github.com/johntfoster" title="My Github"><i class="icon-github"></i></a></li>
            <li><a href="https://twitter.com/johntfoster" title="My Twitter"><i class="icon-twitter"></i></a></li>
            <li><a href="../../archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="../../categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="../../rss.xml" title="RSS"><i class="icon-rss"></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
    <div class="post">
        <h1 class="p-name entry-title" itemprop="headline name">Interactive C++ for HPC</h1>

        <div class="meta">
            <div class="authordate">
                <time class="timeago" datetime="2015-06-08T11:00:18-05:00">2015-06-08 11:00</time>
            
                      |  
        <a href="../interactive-c%2B%2B-for-hpc/index.ipynb" id="sourcelink">Source</a>

            </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../../categories/aztecoo/" rel="tag">AztecOO</a></li>
           <li><a class="tag p-category" href="../../categories/c%2B%2B/" rel="tag">C++</a></li>
           <li><a class="tag p-category" href="../../categories/cling/" rel="tag">cling</a></li>
           <li><a class="tag p-category" href="../../categories/epetra/" rel="tag">Epetra</a></li>
           <li><a class="tag p-category" href="../../categories/trilinos/" rel="tag">Trilinos</a></li>
        </ul>
</div>

        </div>
        <div class="body">
            <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I recently discovered <a href="https://root.cern.ch/drupal/content/cling">cling</a> after I saw this Tweet</p>
<p></p>
<blockquote class="twitter-tweet" lang="en">
<p lang="en" dir="ltr">I made a C++ kernel for Jupyter for some reason: <a href="https://t.co/7ApuZyeR0r">https://t.co/7ApuZyeR0r</a></p>— Min RK (@minrk) <a href="https://twitter.com/minrk/status/600762804161933312">May 19, 2015</a>
</blockquote>
<p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>
<p>From the cling website, "Cling is an interactive C++ interpreter, built on the top of LLVM and Clang libraries. Its advantages over the standard interpreters are that it has command line prompt and uses just-in-time (JIT) compiler for compilation."  As I write (or mostly teach through dual-coding with students) quite a bit of C++ and have already been utilizing the <a href="http://ipython.org/">IPython</a>/<a href="https://jupyter.org/">Jupyter</a> notebook as a teaching tool for sometime, I was immediately interested in using <a href="https://github.com/minrk">MinRK</a>'s <a href="https://github.com/minrk/clingkernel">clingkernel</a> for this purpose as well as exploring and testing out my own ideas.  As I learned more about cling, I found most of the examples to be very trivial and those that inluded the calling/loading of external functions typically only utilized the functions from the standard library.  I was eager to give it try on something a little more complex, and because most of the code we write in my group is heavily dependent on <a href="http://trilinos.org/">Trilinos</a>, I thought I would attempt to solve a simple linear algebra system of the form</p>
$$
A \vec{x} = \vec{b}
$$<p>using <a href="http://trilinos.org/packages/epetra/">AztecOO</a> solvers with <a href="http://trilinos.org/packages/aztecoo/">Epetra</a> datastructures from Trilinos (at least AztecOO and Epetra).  This is an adaptation of the example code provided in Figure 1 of the <a href="http://trilinos.org/oldsite/packages/aztecoo/AztecOOUserGuide.pdf">AztecOO User's guide</a>.</p>
<p>Of course, to reproduce the code below, you will need to <a href="https://github.com/vgvassilev/cling">install cling</a> and Trilinos.  Additionally, if you want to use MinRK's <a href="https://github.com/minrk/clingkernel">clingkernel</a> you need to install the <a href="https://github.com/jupyter/notebook#jupyter-notebook">Jupyter notebook</a> from the <code>master</code> branch, and install the kernel.  With that, you should be able to <a href="http://johntfoster.github.io/posts/interactive-c++-for-hpc.ipynb">download this notebook</a> and execute it with few modifications.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Cling provides a few metaprocessing commands to perform actions that you would normal provide as arguments to the build system, such as providing locations for include files, loading shared libraries, etc.  The documentation for the metaprocessing commands are</p>

<pre><code>.x test.cpp – load a file (if the file defines void test() it will be executed)
.L libname – load a libary or file
.x filename.cxx – loads filename and calls void filename() if defined
.I path – adds an include path
.printAST – shows the abstract syntax tree after each processed entity
.q – exit cling
.help – display a brief description</code></pre>
<p>We'll start by loading the location of the installed header files in my Trilinos build (here I only built AztecOO and Epetra in serial to keep it simple).  Cling utilizes the Clang compiler which is pretty picky, so I had to edit the header files in a few locations where <code>#include</code> statments where provided with angle brackets <code>&lt; &gt;</code> for local includes, where the compiler wanted double quotes.  In other words, I had to change</p>

<pre><code>#include &lt;foo.h&gt;</code></pre>
<p>to</p>

<pre><code>#include "foo.h"</code></pre>
<p>in a few of the Trilinos headers.  So the metaprocessing command to tell the system where the header files are:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="p">.</span><span class="n">I</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">trilinos</span><span class="o">-</span><span class="n">serial</span><span class="o">/</span><span class="n">include</span><span class="o">/</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre></pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And now we provide the include statememts.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="cp">#include</span> <span class="cpf">"AztecOO.h"</span><span class="cp"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre></pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="cp">#include</span> <span class="cpf">"AztecOO_Version.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"Epetra_SerialComm.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"Epetra_Map.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"Epetra_Vector.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"Epetra_CrsMatrix.h"</span><span class="cp"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre></pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now the metaprocessing to load the shared libraries.  Since I'm on a Mac, I had to define the environment variable</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">DYLD_LIBRARY_PATH</span><span class="o">=</span>/usr/local/trilinos-serial/lib:<span class="nv">$DYLD_LIBRARY_PATH</span>
</pre></div>
<p>before launching the notebook/cling so the system knows where to find the libraries at runtime.  On a Linux machine, this variable would be <code>LD_LIBRARY_PATH</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="p">.</span><span class="n">L</span> <span class="n">libepetra</span>
<span class="p">.</span><span class="n">L</span> <span class="n">libaztecOO</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre></pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we start in with the actual Epetra/AztecOO code.  Since it's not apparent to me whether it's possible for <code>cling</code> to support <a href="http://www.open-mpi.org/">MPI</a> processes, we'll just provide a serial implementation.  We start with some code that instantiates the Epetra serial communicator and provides some information about the version of Trilinos we are using.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="n">Epetra_SerialComm</span> <span class="n">Comm</span><span class="p">;</span>
  
<span class="kt">int</span> <span class="n">NumMyElements</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">Comm</span><span class="p">.</span><span class="n">MyPID</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">AztecOO_Version</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">Comm</span> <span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>
AztecOO in Trilinos 12.1 (Dev)


Epetra::Comm::Processor 0 of 1 total processors.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice the immediate output to screen.  Remember this is C++!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we construct a Map that puts same number of equations on each processor.  Of course, we only have one processor here, but the code is generic and could also be run in parallel if multiple processors were available.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="n">Epetra_Map</span> <span class="nf">Map</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">NumMyElements</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Comm</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">NumGlobalElements</span> <span class="o">=</span> <span class="n">Map</span><span class="p">.</span><span class="n">NumGlobalElements</span><span class="p">();</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre></pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we instantiate the column-row sparse matrix $A$</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="n">Epetra_CrsMatrix</span> <span class="nf">A</span><span class="p">(</span><span class="n">Copy</span><span class="p">,</span> <span class="n">Map</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre></pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here we fill $A$ to be a finite-difference like operator.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="kt">double</span> <span class="n">negOne</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">posTwo</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NumMyElements</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">GlobalRow</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="n">GRID</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="kt">int</span> <span class="n">RowLess1</span> <span class="o">=</span> <span class="n">GlobalRow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="kt">int</span> <span class="n">RowPlus1</span> <span class="o">=</span> <span class="n">GlobalRow</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">RowLess1</span><span class="o">!=-</span><span class="mi">1</span><span class="p">)</span> <span class="n">A</span><span class="p">.</span><span class="n">InsertGlobalValues</span><span class="p">(</span><span class="n">GlobalRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">negOne</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">RowLess1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">RowPlus1</span><span class="o">!=</span><span class="n">NumGlobalElements</span><span class="p">)</span> <span class="n">A</span><span class="p">.</span><span class="n">InsertGlobalValues</span><span class="p">(</span><span class="n">GlobalRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">negOne</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">RowPlus1</span><span class="p">);</span>
    <span class="n">A</span><span class="p">.</span><span class="n">InsertGlobalValues</span><span class="p">(</span><span class="n">GlobalRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">posTwo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">GlobalRow</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>?   
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we call the <code>FillComplete()</code> method to optimize storage of the matrix.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="n">A</span><span class="p">.</span><span class="n">FillComplete</span><span class="p">();</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre></pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here we instantiate $\vec{x}$ and the right-hand-side vector $\vec{b}$.  Also, we fill $\vec{b}$ with random numbers for our solution.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="n">Epetra_Vector</span> <span class="nf">x</span><span class="p">(</span><span class="n">Map</span><span class="p">);</span>
<span class="n">Epetra_Vector</span> <span class="nf">b</span><span class="p">(</span><span class="n">Map</span><span class="p">);</span>

<span class="n">b</span><span class="p">.</span><span class="n">Random</span><span class="p">();</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we instantiate the <code>Epetra_Problem</code> and the Aztec solver from that instance.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="n">Epetra_LinearProblem</span> <span class="nf">problem</span><span class="p">(</span><span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>

<span class="n">AztecOO</span> <span class="nf">solver</span><span class="p">(</span><span class="n">problem</span><span class="p">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next is the actual solution step.  A GMRES solver is used for 10 iterations.  This won't be enough for convergence of the solver, but this is just for demonstration purposes and I would like to keep the output short.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="n">solver</span><span class="p">.</span><span class="n">SetAztecOption</span><span class="p">(</span><span class="n">AZ_precond</span><span class="p">,</span> <span class="n">AZ_Jacobi</span><span class="p">);</span>
<span class="n">solver</span><span class="p">.</span><span class="n">Iterate</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1.0E-2</span><span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Solver performed "</span> <span class="o">&lt;&lt;</span> <span class="n">solver</span><span class="p">.</span><span class="n">NumIters</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" iterations."</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Norm of true residual = "</span> <span class="o">&lt;&lt;</span> <span class="n">solver</span><span class="p">.</span><span class="n">TrueResidual</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>
		*******************************************************
		***** Problem: Epetra::CrsMatrix
		***** Preconditioned GMRES solution
		***** 1 step block Jacobi
		***** No scaling
		*******************************************************

                iter:    0           residual = 1.000000e+00
                iter:    1           residual = 5.832906e-01
                iter:    2           residual = 4.547092e-01
                iter:    3           residual = 3.831399e-01
                iter:    4           residual = 3.366700e-01
                iter:    5           residual = 3.043737e-01
                iter:    6           residual = 2.789514e-01
                iter:    7           residual = 2.592427e-01
                iter:    8           residual = 2.449521e-01
                iter:    9           residual = 2.328859e-01
                iter:   10           residual = 2.223153e-01


	***************************************************************

	Warning: maximum number of iterations exceeded
	without convergence

	Solver:			gmres
	number of iterations:	10

	Recursive residual =  3.9447e+00

	Calculated Norms				Requested Norm
	--------------------------------------------	--------------

	||r||_2 / ||r0||_2:		2.223153e-01	1.000000e-02

	***************************************************************



		Solution time: 0.000680 (sec.)
		total iterations: 10

Solver performed 10 iterations.
Norm of true residual = 3.94466
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To demonstrate that is worked, we'll print out the first 10 values of the solution vector $\vec{x}$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-c++"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>-0.288916
-0.723977
-0.641509
0.309992
0.815517
0.904473
0.0381509
-0.675333
-1.5226
-3.14536
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It's pretty amazing to be able to do interactive C++ developement.  If we could get this to work in parallel, it would be a leap forward in the ability to do introspective high-performance scientific computing.</p>

</div>
</div>
</div>
    </div>
  </div>

        </div>
                <ul class="pager hidden-print">
<li class="previous">
                <a href="../pythonnumpy-implementation-of-bspline-basis-functions/" rel="prev" title="Python/Numpy implementation of Bspline basis functions">Previous post</a>
            </li>
            <li class="next">
                <a href="../extracting-exodus-information-with-netcdf-python/" rel="next" title="Extracting Exodus information with netcdf-python">Next post</a>
            </li>
        </ul>
<div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="johntfoster",
            disqus_url="http://johntfoster.github.io/posts/interactive-c%2B%2B-for-hpc/",
        disqus_title="Interactive C++ for HPC",
        disqus_identifier="cache/posts/interactive-c++-for-hpc.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
                    <footer id="footer"><p>Contents © 2021         <a href="mailto:johntfosterjr@gmail.com">John T. Foster</a>      <a rel="license" href="https://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/4.0/80x15.png"></a><br></p>
            
        </footer>
</div>
    </section><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
   })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

   ga('create', 'UA-25324596-7', 'auto');
   ga('send', 'pageview');
</script><script src="../../assets/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="../../assets/js/jquery.timeago.js" type="text/javascript"></script><script src="../../assets/js/mathjax.js" type="text/javascript"></script><script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>
